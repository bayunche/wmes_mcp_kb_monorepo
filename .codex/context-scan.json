{
  "timestamp": "2025-11-28T10:28:00+08:00",
  "module_locations": [
    "apps/worker/src/pipeline.ts（buildSemanticFragments 在无语义切分返回时抛错）",
    "apps/worker/src/worker.ts（createSemanticSegmenter 从 model_settings 读取 role=structure，缺失则返回空）",
    "packages/core/src/semantic-structure.ts（generateStructureViaModel 处理 OpenAI/Ollama 响应与 fallback）",
    "apps/web/src/components/UploadForm.tsx（上传入口，当前未检查模型配置）",
    "apps/web/src/pages/IngestionDashboard.tsx（上传页容器）",
    "apps/web/src/pages/ModelSettingsPage.tsx（租户/库创建 + 模型配置表单）",
    "apps/web/src/api.ts（uploadDocuments 与 fetchModelSettings 用于前端校验配置）"
  ],
  "current_state": {
    "ingestion_pipeline": "语义切分依赖 semanticSegmenter 返回 sections，role=structure 未配置时返回空并导致 chunking 报错。",
    "frontend_upload": "UploadForm 仅校验文件选择/租户库选择，未在提交前检查语义切分或其他模型配置。",
    "tenant_creation": "ModelSettingsPage 通过 prompt 创建租户/库，成功后未提醒补齐模型配置。",
    "config_fetch": "useOrgOptions 仅加载租户/库列表，未暴露模型配置状态；fetchModelSettings 可按 role=structure 查询当前配置。"
  },
  "tech_stack": "Bun + React/Vite 前端，API Fetch 调用；后端 ingestion 使用 TypeScript worker 与 LLM 语义切分。",
  "tests": "无针对 UploadForm/模型配置提醒的自动化测试，需手工自测或补充。",
  "observations": [
    "结构切分缺失是当前 chunking 报错的直接原因，新租户默认无该配置。",
    "前端可在 upload 提交前调用 GET /model-settings?modelRole=structure 检查是否存在配置。",
    "需在租户创建成功时即提醒配置模型，否则上传被阻断。"
  ]
}