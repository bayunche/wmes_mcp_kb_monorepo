{
  "timestamp": "2025-11-29T02:25:00+08:00",
  "module_locations": [
    "apps/web/src/pages/ModelSettingsPage.tsx（模型配置 UI，保存/列表/载入交互与状态管理）",
    "apps/web/src/api.ts（fetchModelSettings/saveModelSettings/fetchModelSettingsList/discoverModels 等 API 封装）",
    "apps/web/src/hooks/useOrgOptions.ts（租户/知识库选项缓存与刷新）",
    "apps/web/src/components/MetricsPanel.tsx（Prometheus 指标展示，包含 refresh 与占位 skeleton）",
    "apps/web/src/styles.css（全局组件样式，当前未定义 metrics-output，pre 文本无换行/滚动约束）"
  ],
  "current_state": {
    "load": "ModelSettingsPage 挂载后 useEffect 调用 loadSetting 与 loadSettingsList；loadSetting 依赖 tenantId/libraryId/modelRole 变化来获取单个配置并填充表单。",
    "save": "ModelSettingsPage handleSave 校验后调用 saveModelSettings，成功时更新 hasStoredKey/apiKeyPreview、清空 apiKey、toast，并刷新 settingsList 与 loadSetting。",
    "list": "settingsList 通过 fetchModelSettingsList 拉取，表格支持点击“载入”回填表单；列表按当前租户/库筛选。",
    "metrics_panel": "MetricsPanel 使用 useAsyncTask 读取 /metrics，loading 时展示 Skeleton，成功后用 <pre class=\"metrics-output\"> 渲染原文；未加样式导致长行溢出容器。",
    "model_options": "远程模型列表通过 discoverModels，受 baseUrl/API Key/模式校验；本地模型通过 fetchLocalModels 扫描 /models/weights。"
  },
  "tech_stack": "前端 Vite + React 18 + TypeScript + Tailwind 风格组件（GlassCard/PillTabs/StatusPill 等）；API 调用使用 fetch，默认 Bearer dev-token 与 x-library-id 头。",
  "tests": "apps/web 未见覆盖 ModelSettingsPage 或 MetricsPanel 的单元/端到端测试；仓库整体使用 Vitest（vitest.config.ts）但前端页面暂无用例。",
  "observations": [
    "模型配置保存后已增加自动 re-fetch，但暂无前端测试覆盖。",
    "Prometheus 输出使用 <pre> 未限制换行或滚动，长行会撑出容器，需要样式约束（如 overflow-x-auto 或 pre-wrap+break-words）。"
  ]
}
