{
  "question_id": "Q3",
  "focus": "向量化是否实际使用本地模型并记录日志？",
  "reason_for_investigation": "需求要求“向量用本地模型进行向量化并记录 log”。需要确认默认配置是否启用本地模型，以及 VectorClient 是否可能走远程/伪向量。",
  "evidence": [
    {
      "file": "apps/worker/src/worker.ts",
      "lines": "24-70",
      "quote": "startWorker 创建 VectorClient 时仅在 config.LOCAL_EMBEDDING_ENABLED 为真时传入 enableLocalModels，其余情况下优先使用 TEXT_EMBEDDING_ENDPOINT/RERANK_ENDPOINT。",
      "implication": "本地模型并非默认启用，若 env 仍为 false 会调用远程 endpoint 或 fallback。"
    },
    {
      "file": ".env.example",
      "lines": "22-40",
      "quote": "LOCAL_EMBEDDING_ENABLED=false，TEXT_EMBEDDING_ENDPOINT/RERANK_ENDPOINT/IMAGE_EMBEDDING_ENDPOINT 均为空；README 亦未要求修改。",
      "implication": "默认模板没有打开本地模型，也没有说明必须配置本地模型 ID。",
      "note": "README 未出现 LOCAL_EMBEDDING 相关指引 (rg 搜索结果为空)。"
    },
    {
      "file": "packages/core/src/vector.ts",
      "lines": "134-174",
      "quote": "VectorClient.embedText 逻辑：若 textEndpoint 存在则调用远程；否则若 enableLocalModels 则加载 @xenova/transformers；若两者都不满足则回退为 deterministicVector（伪向量）。",
      "implication": "即便未设置远程 endpoint，本地未启用时只会生成伪向量，不符合“使用本地模型”要求。"
    }
  ],
  "findings": [
    "默认配置没有开启 LOCAL_EMBEDDING_ENABLED，部署者必须手动设置才会用本地模型，否则 pipeline 仍然调用远程或 fallback。",
    "README 中没有明确说明必须启用本地模型，因此按仓库默认运行会违反“向量用本地模型”要求。",
    "VectorClient 在本地模型失败时会静默回退到 deterministicVector，并仅在 vector log metadata 标记 fallback=true，缺少强制失败机制。"
  ],
  "conclusion": "项目允许可选的本地模型，但默认关闭且有远程/伪向量 fallback，与需求中“向量化必须使用本地模型并记录日志”不完全一致。",
  "cost_alert": "第 3 次深挖：评估成本，避免继续扩大全局信息收集。"
}
