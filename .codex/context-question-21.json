{
  "question_id": "Q4",
  "focus": "模型配置/切换的 API 与 UI 目前如何实现？",
  "reason_for_investigation": "需求要求“模型列表通过 API 获取、可回显并手动切换配置”，需掌握现有 /model-settings 能力与差距。",
  "evidence": [
    {
      "file": "apps/api/src/routes.ts",
      "lines": "426-457",
      "quote": "handleGetModelSettings/handleSaveModelSettings 只支持 tenant+library 唯一键 -> 单条配置；响应结构为 {setting}，没有列表或多模型信息。",
      "implication": "API 无法列出多个模型或区分用途（标签/语义元数据/向量日志）。"
    },
    {
      "file": "packages/data/src/repositories/modelSettings.ts",
      "lines": "1-60",
      "quote": "PgModelSettingsRepository.get/upsert 也是按 tenant/library 查询单条记录。",
      "implication": "数据层缺少模型多版本或角色字段，无法支撑“手动切换配置”或“模型列表”。"
    },
    {
      "file": "apps/web/src/pages/ModelSettingsPage.tsx",
      "lines": "1-120",
      "quote": "前端只提供单表单，固定 provider 枚举和 baseUrl/modelName 输入，没有模型列表或切换控件，无法展示实时回显。",
      "implication": "UI 不能仿照 maxkb 的模型列表/切换体验。"
    }
  ],
  "findings": [
    "需要扩展 model_settings 表，引入 modelRole（embedding/tagging/metadata/ocr 等）或允许同一库配置多条记录。",
    "API 需提供 /model-settings 列表、GET by role、PATCH/DELETE 等操作，并暴露模型可用性（可通过远程 API 获取模型列表）。",
    "Web UI 需要模型列表视图 + 选择器，允许在 maxkb 风格页面直接切换并看到回显。"
  ],
  "conclusion": "现有实现无法满足“模型列表+回显+手动切换”需求，必须在数据层/API/UI 全面扩展。",
  "cost_alert": "第 4 次深挖，建议停止继续收集上下文，转入规划与实施。"
}
