FROM oven/bun:canary AS base
WORKDIR /app

COPY package.json bun.lock bunfig.toml tsconfig.json tsconfig.base.json vitest.config.ts ./
COPY apps ./apps
COPY packages ./packages
COPY scripts ./scripts
COPY docs ./docs
COPY assets ./assets
COPY ops ./ops
COPY db ./db
COPY tests ./tests

RUN bun install --backend=copyfile \
  && mkdir -p /app/packages/data/node_modules \
  && cp -a /app/node_modules/. /app/packages/data/node_modules/

ENV NODE_ENV=production
ENV START_MCP_SERVER=true
CMD ["bun", "run", "apps/mcp/src/main.ts"]
